<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Piano</title>
	<style>
		body {
			background-color: black;
			color: white;
			font-family: "Arial", sans-serif;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			height: 100vh;
			overflow-x: hidden;
		}
		h1 {
			font-size: 2em;
			margin-bottom: 10px;
		}
		#sub-instruction {
			font-size: 0.9em;
			font-weight: 300;
			color: #ccc;
			margin-bottom: 40px;
		}
		#keyboard {
			position: relative;
			display: flex;
			padding: 0 80px;
		}
		.white {
			width: 48px;
			height: 220px;
			background: linear-gradient(180deg, #fafafa, #ddd);
			border: 1px solid #999;
			border-radius: 6px;
			box-shadow: 0 4px 10px rgba(255,255,255,0.1);
			z-index: 1;
			transition: transform 0.1s ease, box-shadow 0.1s ease;
			position: relative;
		}
		.black {
			width: 30px;
			height: 130px;
			background: linear-gradient(180deg, #333, #000);
			border-radius: 4px;
			position: absolute;
			margin-left: -15px;
			z-index: 2;
			transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
		}
		.key.active {
			transform: scale(1.07) translateY(2px);
			box-shadow: 0 0 25px #38bdf8;
			background: #7dd3fc;
		}
		#note-display {
			margin-top: 40px;
			font-size: 1.6em;
			height: 30px;
			color: #7dd3fc;
		}
		#octave-display {
			margin-top: 10px;
			font-size: 1em;
			color: #aaa;
		}
		.star-container {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 1000;
		}
		.star {
			position: absolute;
			background: white;
			clip-path: polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);
			opacity: 0;
		}
		.star.star-glow {
			animation: star-glow 2s ease-out forwards;
		}
		.star.star-dim {
			background: #cccccc;
			animation: star-slow 4s ease-out forwards;
		}
		@keyframes star-glow {
			0% {
				transform: scale(0.5);
				opacity: 0;
			}
			50% {
				transform: scale(1.5) rotate(180deg);
				opacity: 1;
			}
			100% {
				transform: scale(0.5) rotate(360deg);
				opacity: 0;
			}
		}
		@keyframes star-slow {
			0% {
				transform: scale(0.3);
				opacity: 0;
			}
			50% {
				transform: scale(1) rotate(180deg);
				opacity: 0.9;
			}
			100% {
				transform: scale(0.3) rotate(360deg);
				opacity: 0;
			}
		}
		.key-label {
			position: absolute;
			bottom: 7px;
			left: 50%;
			transform: translateX(-50%);
			color: #222;
			font-size: 14px;
			font-weight: 400;
			pointer-events: none;
			opacity: 0;
			transition: opacity 0.3s;
		}
		.black .key-label {
			color: #fff;
		}
		.show-labels .key-label {
			opacity: 1;
		}
		#top-right-instruction {
			position: absolute;
			top: 15px;
			right: 25px;
			text-align: right;
			font-size: 0.9em;
			font-weight: 300;
			color: #ccc;
			line-height: 1.4;
			opacity: 0;
			transition: opacity 0.4s ease;
			pointer-events: none;
		}
		#top-right-instruction.visible {
			opacity: 1;
		}
		.water-line {
			position: absolute;
			width: 100%;
			height: 2px;
			background: linear-gradient(90deg,rgba(255,255,255,0) 0%,rgba(255,255,255,0.8) 50%,rgba(255,255,255,0) 100%);
			left: -100%;
			opacity: 0;
			animation: water-flow 3s linear forwards;
			filter: blur(1px);
		}
		@keyframes water-flow {
			0% {left: -100%; opacity: 0;}
			20% {opacity: 1;}
			80% {opacity: 1;}
			100% {left: 100%; opacity: 0;}
		}
	</style>
</head>
<body>
	<h1>Press Keys</h1>
	<div id="sub-instruction">Press the ‘0’ key to view the instructions.</div>
	<div id="keyboard"></div>
	<div id="note-display"></div>
	<div id="octave-display">Current Octave: 4</div>
	<div id="star-effect-container" class="star-container"></div>

	<div id="top-right-instruction">
		You can change octaves using the 3, 4, and 5 keys.<br>
		When changing to the 3rd or 5th octave, the keys function as indicated on the keyboard.<br><br>
		- Twinkle Twinkle Little Star: C C G G A A G<br>
		- River Flows on You: A G# A G# A E A D<br>
	</div>

	<script>
		function playSound(note){ 
			const audio=new Audio(`https://raw.githubusercontent.com/fuhton/piano-mp3/master/mp3/${note}.mp3`);
			audio.currentTime=0;
			audio.play();
		}

		const whiteNotes=["C","D","E","F","G","A","B"];
		const blackNotes=["C#","D#","","F#","G#","A#",""];
		const keyMap={
			A:"C",W:"C#",S:"D",E:"D#",D:"E",F:"F",T:"F#",G:"G",Y:"G#",H:"A",U:"A#",J:"B"
		};

		let currentOctave=4;
		const keyboard=document.getElementById("keyboard");
		let position=0;
		let blank=0;
		const twinkleStar4=["C4","C4","G4","G4","A4","A4","G4"];
		const twinkleStar3=["C3","C3","G3","G3","A3","A3","G3"];
		let inputMelody=[];
		const starContainer=document.getElementById('star-effect-container');

		let audioContext=null;
		let isAudioUnlocked=false;

		for(let octave=3;octave<=5;octave++){
			for(let i=0;i<whiteNotes.length;i++){
				const whiteKey=document.createElement("div");
				whiteKey.classList.add("key","white");
				whiteKey.dataset.note=`${whiteNotes[i]}${octave}`;
				keyboard.appendChild(whiteKey);
				if(blackNotes[i]!==""){
					const blackKey=document.createElement("div");
					blackKey.classList.add("key","black");
					blackKey.dataset.note=`${blackNotes[i]}${octave}`;
					blackKey.style.left=`${position*49+blank+129}px`;
					keyboard.appendChild(blackKey);
				}else blank++;
				position++;
			}
		}

		function createStars(effectClass,duration){
			starContainer.innerHTML='';
			const numStars=Math.floor(Math.random()*8)+7;
			for(let i=0;i<numStars;i++){
				const star=document.createElement('div');
				star.classList.add('star',effectClass);
				const randomX=Math.random()*window.innerWidth;
				const randomY=Math.random()*window.innerHeight;
				star.style.left=`${randomX}px`;
				star.style.top=`${randomY}px`;
				const randomSize=Math.floor(Math.random()*21)+10;
				star.style.width=`${randomSize}px`;
				star.style.height=`${randomSize}px`;
				const randomDelay=Math.random()*0.5;
				star.style.animationDelay=`${randomDelay}s`;
				starContainer.appendChild(star);
				setTimeout(()=>{star.remove();},duration*1000+500);
			}
		}

		function createWaterFlow(){
			for(let i=0;i<10;i++){
				const line=document.createElement('div');
				line.classList.add('water-line');
				line.style.top=`${Math.random()*window.innerHeight}px`;
				line.style.animationDelay=`${Math.random()*0.6}s`;
				document.body.appendChild(line);
				setTimeout(()=>{line.remove();},3000);
			}
		}

		function checkMelody(note){
			inputMelody.push(note);
			if(inputMelody.length>8) inputMelody.shift();
			const currentInputString=inputMelody.join(',');
			if(currentInputString===twinkleStar4.join(',')){
				createStars('star-glow',2);
				inputMelody=[];
			}else if(currentInputString===twinkleStar3.join(',')){
				createStars('star-dim',4);
				inputMelody=[];
			}else if(currentInputString==="A4,G#4,A4,G#4,A4,E4,A4,D4"){
				createWaterFlow();
				inputMelody=[];
			}
		}

		const noteToKey=Object.entries(keyMap).reduce((obj,[key,note])=>{
			obj[note]=key;
			return obj;
		},{});

		[...document.querySelectorAll(".key")].forEach(k=>{
			const octave=parseInt(k.dataset.note.match(/[0-9]/)[0]);
			if(octave===4){
				const noteName=k.dataset.note.replace(/[0-9]/g,"");
				const keyChar=noteToKey[noteName];
				if(keyChar){
					const label=document.createElement("div");
					label.classList.add("key-label");
					label.textContent=keyChar.toUpperCase();
					k.appendChild(label);
				}
			}
		});

		let showLabels=false;
		document.addEventListener("keydown",(e)=>{
			const key=e.key.toUpperCase();
			if(e.repeat) return;
			if(!isAudioUnlocked){
				if(!audioContext){
					audioContext=new (window.AudioContext || window.webkitAudioContext)();
				}
				
				if(audioContext.state==='suspended'){
					audioContext.resume().then(()=>{
						isAudioUnlocked=true;
					});
				}else{
					isAudioUnlocked=true;
				}
			}
			if(["3","4","5"].includes(key)){
				currentOctave=parseInt(key);
				document.getElementById("octave-display").textContent=`Current Octave: ${currentOctave}`;
				return;
			}
			if(e.key==="0"){
				showLabels=!showLabels;
				keyboard.classList.toggle("show-labels",showLabels);
				const info=document.getElementById("top-right-instruction");
				info.classList.toggle("visible");
				return;
			}

			const baseNote=keyMap[key];
			if(!baseNote) return;
			const note=`${baseNote}${currentOctave}`;
			const keyEl=[...document.querySelectorAll(".key")].find(k=>k.dataset.note===note);
			if(keyEl){
				if(!keyEl.classList.contains("active")){
					keyEl.classList.add("active");
					document.getElementById("note-display").textContent=note;
					
					if(isAudioUnlocked){
						playSound(note);
						checkMelody(note);
					}
				}
			}
		});

		document.addEventListener("keyup",(e)=>{
			const key=e.key.toUpperCase();
			const baseNote=keyMap[key];
			if(!baseNote) return;
			const note=`${baseNote}${currentOctave}`;
			const keyEl=[...document.querySelectorAll(".key")].find(k=>k.dataset.note===note);
			if(keyEl) keyEl.classList.remove("active");
		});
	</script>
</body>
</html>

